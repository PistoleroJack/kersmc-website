<!-- /login.html -->
<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <title>Login - KersMC</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="icon" href="/logos/KersMC_logo.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css">
</head>
<body>
  <div class="section">
    <div class="container">
      <div class="box" style="max-width:520px;margin:80px auto;text-align:center;">
        <img src="/logos/KersMC_logo.png" alt="KersMC Logo" style="max-width:140px">
        <h1 class="title is-3">Inloggen bij KersMC</h1>
        <p>Klik op de knop om in te loggen via Auth0.</p>
        <button id="loginBtn" class="button" style="background:#ff0707;color:white;margin-top:18px">Log in met Auth0</button>
      </div>
    </div>
  </div>

  <!-- Auth0 SDK (v2) -->
  <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>

  <script>
  (async () => {
    const AUTH0_DOMAIN = "kersmc.eu.auth0.com";
    const AUTH0_CLIENT_ID = "OtaKg92TfevmL5KR18EsAgwdSxjOZC6A";

    // Haal returnTo (waar de gebruiker heen wilde) uit de query string
    const url = new URL(window.location.href);
    const raw = url.searchParams.get('returnTo') || '/dashboard/';
    const returnTo = raw.startsWith('/') ? raw : '/dashboard/';

    const redirectUri = window.location.origin + '/dashboard/callback.html';

    // Wacht tot SDK geladen is
    while (typeof createAuth0Client === 'undefined') {
      await new Promise(r => setTimeout(r, 50));
    }

    const auth0 = await createAuth0Client({
      domain: AUTH0_DOMAIN,
      client_id: AUTH0_CLIENT_ID
    });

    document.getElementById('loginBtn').addEventListener('click', async () => {
      await auth0.loginWithRedirect({
        authorizationParams: { redirect_uri: redirectUri },
        appState: { target: returnTo }
      });
    });
  })();
  </script>
</body>
</html>
